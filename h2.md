# Lisää vain vesi

## x) Tiivistys 

Jaswal 2020: Mastering Metasploit - 4ed: Chapter 1: Approaching a Penetration Test Using Metasploit (kohdasta [Conducting a penetration test with Metasploit](https://learning.oreilly.com/library/view/mastering-metasploit/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-31) luvun loppuun eli "Summary" loppuun)

```
Metasploitissa käytetyt perustermit:

-Exploits: Koodinpätkä, joka suorittaessa hyödyntää kohteen haavoittuvuutta

-Payload: Koodinpätkä, joka suoritetaan kohteessa onnistuneen hyödyntämisen jälkeen.
 Määrittelee toimet, mitä haluamme suorittaa kohdejärjestelmässä.

-Auxiliary: Moduuleja, jotka tarjoavat toimintoja kuten "scanning, fuzzing, sniffing" jne.

-Encoders: Encodereita käytetään moduulien peittämiseen, jotta ne eivät jää havaituksi.

-Meterpreter: "Meterpreter is a payload that uses in-memory DLL injection stagers."
Tarjoaa monia toimintoja, joita voi suorittaa kohdejärjestelmässä.

```

Metasploitin avulla suoritettavan penauksen edut

- Open source
- Tuki massiivisille verkkotestauksille
- Metasploit testaa kaikki järjestelmät haavoittuvuuden hyödyntämiseksi, käyttämällä parametrejä kuten aliverkon ja luokittamattoman verkkotunnusten välisen reitityksen (CIDR) arvoja
- Payload generation and switching mechanism
- Poistuu puhtaammin järjestelmistä, joihin se on tunkeutunut

Case study - Metasploitin perusteet

- Tiedon kerääminen, kerätään mahdollisimman paljon tietoa kohteesta. Aktiivisten ja passiivisten skannausten avulla, kuten porttien skannaus, banner grabbing (esim. avoimissa porteissa käynnissä olevat palvelut) ja muut skannaukset.

- Tietokantojen hyödyntäminen, aina on parempi tallentaa tulokset automaattisesti ja rakentaa tietopohja, joka sisältää kohteena olevat hostit, palvelut ja haavoittuvuudet.
  ```workspace -a``` lisää uuden workspacen metasploitablessa
  
- Porttien skannaus, Metasploitin ```db_nmap``` skriptien avulla selvitetään kohteen alttiuksia haavoittuvuuksille ja kuinka kohteeseen mahdollisesti päästään käsiksi. Nmap-komentoon voidaan asettaa ```-Pn``` joka tarkoittaa "ei ping-skannausta" ja myös ```-sV``` joka tarkoittaa versioskannausta. 
 
- Uhkan mallintaminen, tapahtuu tiedusteluvaiheen jälkeen kun kohteen alttiudet haavoittuvuuksille on selvitetty. Metasploitissa voi etsiä moduuleja haavoittuvuuttavarten, moduulien tasot Metasploitissa on määritelty ```Low -> Average -> Normal -> Good -> Great -> Excellent``` Auxiliary moduulilla voi varmistaa onko kohde haavoittuvainen.
  
- Haavoittuvuuksien analysointi, Metasploitin moduuli kertoo miten hyökkäys toimii.
  
- Haavoittuvuuden hyödyntäminen ja pääsyn saaminen, Metasploitin esimerkissä hyödynnetään EternalBlue- haavoittuvuutta Windows 7 järjestelmässä. Hyökkäyksen ajamalla saadan shell-käyttöoikeus. Koska tämä yhteys voi olla epävakaa, se päivitetään vakaammaksi Meterpreter-shelliksi, jolla saavutetaan korkeimmat mahdolliset SYSTEM-oikeudet kohdejärjestelmässä.
  
- Hyödyntämisen jälkeinen kung-fu, jälkihyökkäyksen tarkoituksena on vahvistaa asemaa kun pääsy kohteeseen on saatu. Pyritään siirtymään turvallisempaan prosessiin, kerätä tietoja kohteesta. Esimerkissä  löydettyjen ylläpitoprosessien avulla saadan pääsy kohteen Domain Controlleriin Active Directory- ympäristössä sijaitsevan vaarantuneen koneen kautta.

## Tehtävät

### a) 
Osoita testein että koneet eivät saa yhteyttä internetiin

<img width="1368" height="272" alt="image" src="https://github.com/user-attachments/assets/77cfe514-f06d-491b-aa21-7da8071faece" />

<img width="722" height="214" alt="image" src="https://github.com/user-attachments/assets/35199900-c65f-47af-8f15-bf964ba7091b" />

### b) Msfconsole

Otin msfconsolen käyttöön ja loin uuden workspacen

<img width="1462" height="562" alt="image" src="https://github.com/user-attachments/assets/737c7634-280b-417a-899b-c12f4b05c215" />
<img width="1458" height="125" alt="image" src="https://github.com/user-attachments/assets/cf81e519-f432-4bd5-a6cb-42dd42cc28ca" />

### c)

Ajoin msfconsolessa komennon ```db_nmap -sn``` virtuaaliverkon aliverkolle ja tarkastelin ```hosts```

<img width="1465" height="423" alt="image" src="https://github.com/user-attachments/assets/e14164ae-86ca-402f-980a-6e141f652fff" />

Tarkastus vielä että ```192.168.56.102``` on kohteena

<img width="1867" height="539" alt="image" src="https://github.com/user-attachments/assets/9c5a14e2-23b9-4f26-a209-5b4b1597c6d7" />

*verkkoyhteys pois päältä*

### d) 

Porttiskannataan metasploitin kaikki 65535 TCP-porttia

<img width="1397" height="627" alt="image" src="https://github.com/user-attachments/assets/164a572e-85fb-47d4-8c80-fef96e558ac1" />

Sitten ajoin vielä saman mutta lisäsin komentoon ```-oA foo``` joka tallentaa tiedostoihin tulokset

### e)

Tehty porttiskannaus ei ```hosts``` kerro vielä juuri mitään

<img width="1390" height="131" alt="image" src="https://github.com/user-attachments/assets/80b23182-ee52-4496-b06c-89d32419544c" />

Mutta  ```services``` näyttää että kyllä sain porteista tietoa 


<img width="1395" height="586" alt="image" src="https://github.com/user-attachments/assets/68b2f8b9-8b56-4aa1-92be-0d26e47be8e9" />

Voimme tarkastella myös ```hosts -r``` ja portteja kuten ```servives -p 514``` tarkemmin


<img width="1395" height="293" alt="image" src="https://github.com/user-attachments/assets/13b11eca-f309-46ee-9877-f8448bdd6a4f" />

### f)

Kun tallensin tulokset tiedostoihin voin vaikka etsiä tiettyä porttia ```grep "514/open" foo.gnmap``` ja etsiä näin haavoittuvuuksia ja arkistoida niitä.

<img width="1388" height="260" alt="image" src="https://github.com/user-attachments/assets/16eded62-5229-45f9-b110-e6e8fa4060f6" />


Metasploitin tietokantaan kannattaa tallentaa tulokset automaattisesti ja rakentaa tietopohja, joka sisältää kohteena olevat hostit, palvelut ja haavoittuvuudet

### g) 

Yritetään murtautua vsftpd-palveluun. Aloitin etsimällä ```search vsftpd```

<img width="1417" height="210" alt="image" src="https://github.com/user-attachments/assets/d72b9b5b-93a8-4661-9b5c-22c38cda67f4" />

Kuten näkyy niin moduuleja löytyi kaksinkappalein ja kuten kurssin tunnilla käytän backdoor exlpoittia vsftpd 2.3.4

<img width="1413" height="161" alt="image" src="https://github.com/user-attachments/assets/7d3efb1a-af0d-433c-8513-80723b78ff73" />

Exploit toimi mutta mitään ei tapahtunut, joten tarkistin vielä onko versio oikea ja ip-osoite oikea

<img width="1397" height="207" alt="image" src="https://github.com/user-attachments/assets/9895ec62-45e6-427b-9e34-f7e1a5f4b7c8" />

Ajoin exploitin uudestaan ja sehän toimi mystisesti

<img width="1418" height="240" alt="image" src="https://github.com/user-attachments/assets/7cc9e558-4866-4454-a429-5a36f4e3eba4" />

<img width="1247" height="417" alt="image" src="https://github.com/user-attachments/assets/b563bd47-932e-4dc7-a0ba-38bae3dd58b3" />


### h)

En tiedä miksi sessions ei näy

<img width="699" height="132" alt="image" src="https://github.com/user-attachments/assets/db96ba2a-a777-4b77-bbb8-15185a772316" />
Sain sessiot näkyviin, kun tajusin että suljin itse aktiivisen session kokoajan.

<img width="1231" height="173" alt="image" src="https://github.com/user-attachments/assets/d9fad2ac-8d0d-406e-96ca-581d4330c341" />
Sitten Upgradesin shellin meterpreteriin ``` sessions -u 1 ```

<img width="1237" height="194" alt="image" src="https://github.com/user-attachments/assets/513635dd-4978-4730-903a-110bf1f611c4" />


# Lähteet

https://terokarvinen.com/tunkeutumistestaus

Jaswal 2020: Mastering Metasploit - 4ed: Chapter 1: Approaching a Penetration Test Using Metasploit (kohdasta [Conducting a penetration test with Metasploit](https://learning.oreilly.com/library/view/mastering-metasploit/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-31) luvun loppuun eli "Summary" loppuun) Luettu. 31.8.2025

